(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{156:function(t,a,s){"use strict";s.r(a);var n=s(0),o=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"lottery-phase-iii"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lottery-phase-iii","aria-hidden":"true"}},[t._v("#")]),t._v(" Lottery Phase III")]),s("h2",{attrs:{id:"eventify"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eventify","aria-hidden":"true"}},[t._v("#")]),t._v(" Eventify")]),s("ul",[s("li",[t._v("Edit "),s("code",[t._v("Lottery.ksmile")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("stream-module LotteryStream at com.metastay.lotterystream \n")])])]),s("ul",[s("li",[t._v("$smile")]),s("li",[t._v("Edit "),s("code",[t._v("LotteryStream.kstream")]),t._v(" , add  lottery related events")])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("event LotteryCreated(lotteryName: String, amount: Int)\nevent ParticipantAdded(lotteryName: String, participantName: String)\nevent LotteryRan(lotteryName: String, winner: String) \n")])])]),s("ul",[s("li",[t._v("$compile")]),s("li",[t._v("Edit "),s("code",[t._v("LotteryStreamTestSuite.scala")])])]),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[t._v("test"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"test1"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Tag"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"event"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" created "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LotteryCreated"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"Loto"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("2000")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    LotteryStreamWriter"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("appendEvent"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("created"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" ramAdded "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" ParticipantAdded"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"Loto"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('"ram"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    LotteryStreamWriter"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("appendEvent"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ramAdded"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" johnAdded "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" ParticipantAdded"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"Loto"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('"john"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    LotteryStreamWriter"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("appendEvent"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("johnAdded"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" ran "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LotteryRan"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"Loto"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('"john"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    LotteryStreamWriter"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("appendEvent"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ran"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n \ntest"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"test2"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Tag"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"read"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    LotteryStreamReader"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("count"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("println\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("See "),s("code",[t._v("lotterystream.conf")]),t._v(" file, database and how the events are getting stored.")])]),s("h2",{attrs:{id:"events-and-commands"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#events-and-commands","aria-hidden":"true"}},[t._v("#")]),t._v(" Events and Commands")]),s("ul",[s("li",[t._v("Add stream dependency to Domain module in lottery.ksmile.")])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("domain-module LotteryDomain(LotteryMongo,LotteryStream) at com.metastay.lotterydomain\n")])])]),s("ul",[s("li",[t._v("add stream to command-set and raise events from commands in "),s("code",[t._v("LotteryDomain.kdomain")])])]),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[t._v("command"),s("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("set"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("LotteryStream"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Lottery "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    domain"),s("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("logic"),s("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("ref lottery"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("Lottery\n    command create "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        input"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lotteryName"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),s("span",{attrs:{class:"token builtin"}},[t._v("String")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" amount"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),s("span",{attrs:{class:"token builtin"}},[t._v("Int")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        pre "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            condition lotterMustNotExist "),s("span",{attrs:{class:"token string"}},[t._v('"Lottery must not exist"')]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("!")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lottery"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryNameExists"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        event"),s("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("raised"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("created"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("LotteryCreated"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    command addParticipant "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        input"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lotteryName"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),s("span",{attrs:{class:"token builtin"}},[t._v("String")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" participantName"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),s("span",{attrs:{class:"token builtin"}},[t._v("String")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        pre "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            condition lotteryMustExists "),s("span",{attrs:{class:"token string"}},[t._v('"Lottery must exist"')]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" lottery"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryNameExists"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            condition newParticpant "),s("span",{attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("lottery"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("participantExist"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("participantName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n                failing "),s("span",{attrs:{class:"token string"}},[t._v('"participant ${input.participantName} is already add to this lottery"')]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        event"),s("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("raised"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("added"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("ParticipantAdded"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    command run "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        input "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lotteryName"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token builtin"}},[t._v("String")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        pre"),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            condition notYetRun "),s("span",{attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" lottery"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isOpenToRun"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" failing "),s("span",{attrs:{class:"token string"}},[t._v('"Lottery has already run!"')]),t._v("\n            condition existingLotteryName "),s("span",{attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" lottery"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryNameExists"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n                failing "),s("span",{attrs:{class:"token string"}},[t._v('"Lottery name does not exist"')]),t._v("\n            condition atLeastTwoParticipants "),s("span",{attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" \n                existingLotteryName "),s("span",{attrs:{class:"token operator"}},[t._v("-")]),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" `domainLogicRef"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lottery"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("participantCount"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("1")]),t._v("` \n                failing "),s("span",{attrs:{class:"token string"}},[t._v('"The lottery should have at least two participants"')]),t._v("\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        event"),s("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("raised"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ran"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" LotteryRan"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        output"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("winner"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token builtin"}},[t._v("String")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("$smile")]),s("li",[t._v("$compile")]),s("li",[t._v("comment the existing code in "),s("code",[t._v("LotteryCommandSetCode")]),t._v(" and fix the compilation error")])]),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[t._v("    "),s("span",{attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" create "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" CreateCommand "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" CreateCommand"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_\n      input"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" Input "),s("span",{attrs:{class:"token keyword"}},[t._v("=>")]),t._v("\n        EventRaised"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LotteryCreated"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("amount"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" addParticipant "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" AddParticipantCommand "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" AddParticipantCommand"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_\n      input"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" Input "),s("span",{attrs:{class:"token keyword"}},[t._v("=>")]),t._v("\n        EventRaised"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ParticipantAdded"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("participantName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" run "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" RunCommand "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" RunCommand"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_\n      input"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" Input "),s("span",{attrs:{class:"token keyword"}},[t._v("=>")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" participantCount "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" domainLogicRef"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lottery"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("participantCount"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" winnerIndex "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" scala"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Random"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextInt"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("participantCount"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" participantList "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LotteryQuery"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("findOne"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("participantList\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" winner "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" participantList"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("winnerIndex"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        EventRaised"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LotteryRan"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" winner"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("-")]),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" Output"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("winner"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("Edit "),s("code",[t._v("LotteryDomain.kdomain")]),t._v(" and add the handler after domain-logic definition")])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("event-handler[LotteryStream] LotteryStream {\n    LotteryCreated,ParticipantAdded,LotteryRan\n}\n")])])]),s("ul",[s("li",[t._v("$compile")]),s("li",[t._v("move the commented code from "),s("code",[t._v("LotteryCommandSetCode")]),t._v(" to "),s("code",[t._v("LotteryStreamEventHandlerCode")])])]),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" handleException"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" LotteryStreamEvent"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" EventContext"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" throwable"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" Throwable"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token builtin"}},[t._v("Unit")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  appLogger"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("error"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"LotteryStreamEventHandler failed: "')]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" throwable"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stackTraceString"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("size "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("50")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" handle"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" LotteryCreated"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" EventContext"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token builtin"}},[t._v("Unit")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("\n  LotteryWriter"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("save"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LotteryRow"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lotteryName "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" amount "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("amount"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" open "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token boolean"}},[t._v("true")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" handle"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" ParticipantAdded"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" EventContext"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token builtin"}},[t._v("Unit")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LotteryQuery"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" u "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LotteryUpdate"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("participantList"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("addToSet"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("participantName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  LotteryWriter"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updateOne"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("q"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" u"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" handle"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" LotteryRan"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" EventContext"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token builtin"}},[t._v("Unit")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LotteryQuery"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" u "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LotteryUpdate"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("open"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("set"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token boolean"}},[t._v("false")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("winner"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("set"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("winner"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  LotteryWriter"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updateOne"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("q"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" u"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("$run")]),s("li",[t._v("Test through url in browser http://localhost:9000/api/lottery/lottery-list")]),s("li",[t._v("or run any tests, nothing should change")])]),s("h2",{attrs:{id:"command-testing"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#command-testing","aria-hidden":"true"}},[t._v("#")]),t._v(" Command Testing")]),s("ul",[s("li",[t._v("Edit "),s("code",[t._v("CreateCommandTestSuite.scala")])])]),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[t._v("test"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"create first lottery"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Tag"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"create"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ptest"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    LotteryWriter"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("drop"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    grab"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("CreateCommandFixture"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("given"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("when"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Input"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"TestLottery"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("200")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expectEventRaised"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("EventRaised"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LotteryCreated"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"TestLottery"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("200")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\ntest"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"create new lottery with same name"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Tag"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"duplicate"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ntest"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    LotteryWriter"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("drop"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    grab"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("CreateCommandFixture"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("given"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LotteryCreated"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"TestLottery"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("100")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("when"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Input"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"TestLottery"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("200")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expectPreFail"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"lotterMustNotExist"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("$test-only com.metastay.lotterydomain.commandset.lottery.CreateCommandTestSuite")]),s("li",[t._v("Edit AddParticipantCommandTestSuite.scala")])]),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[t._v("test"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"add a participant"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Tag"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"add"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ptest"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    grab"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("AddParticipantCommandFixture"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("given"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LotteryCreated"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"TestLottery"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("1000")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("when"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Input"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lotteryName"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"TestLottery"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" participantName"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"John"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expectEventRaised"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("EventRaised"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ParticipantAdded"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lotteryName"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"TestLottery"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" participantName"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"John"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\ntest"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"add participant with same name"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Tag"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"duplicate"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ntest"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    grab"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("AddParticipantCommandFixture"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("given"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LotteryCreated"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"TestLottery"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("1000")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        ParticipantAdded"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lotteryName"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"TestLottery"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" participantName"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"John"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("when"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Input"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lotteryName"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"TestLottery"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" participantName"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"John"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expectPreFail\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("$test-only com.metastay.lotterydomain.commandset.lottery.AddParticipantCommandTestSuite")])]),s("h2",{attrs:{id:"projection"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#projection","aria-hidden":"true"}},[t._v("#")]),t._v(" Projection")]),s("ul",[s("li",[t._v("Edit "),s("code",[t._v("Lottery.ksmile")])]),s("li",[t._v("Also add dependency of LotteryQuery in the Play module.")])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("mongo-module LotteryReadMongo at com.metastay.lotteryreadmongo\nquery-module LotteryQuery(LotteryReadMongo, LotteryStream) at com.metastay.lotteryquery\n")])])]),s("ul",[s("li",[t._v("$smile,refresh eclipse")]),s("li",[t._v("edit "),s("code",[t._v("LotteryReadMongo.kmongo")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("collection LotteryRead {\n  property lotteryName:String\n  property amount:Int\n  property participantList:String*\n  property winner:String?\n  property open:Boolean\n}\n")])])]),s("ul",[s("li",[t._v("edit LotterQuery.kqyuery")])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("projector [LotteryStream] Lottery {\n    LotteryCreated,ParticipantAdded,LotteryRan\n}\n")])])]),s("ul",[s("li",[t._v("$compile")]),s("li",[t._v("Edit "),s("code",[t._v("LotteryProjectorCode")])])]),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" project"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" LotteryCreated"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" EventContext"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token builtin"}},[t._v("Unit")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    LotteryReadWriter"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("save"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LotteryReadRow"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lotteryName "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" amount "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("amount"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" open "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token boolean"}},[t._v("true")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" project"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" ParticipantAdded"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" EventContext"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token builtin"}},[t._v("Unit")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LotteryReadQuery"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" u "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LotteryReadUpdate"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("participantList"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("addToSet"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("participantName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    LotteryReadWriter"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updateOne"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("q"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" u"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" project"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" LotteryRan"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" EventContext"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token builtin"}},[t._v("Unit")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LotteryReadQuery"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" u "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LotteryReadUpdate"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("open"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("set"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token boolean"}},[t._v("false")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("winner"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("set"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("winner"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    LotteryReadWriter"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updateOne"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("q"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" u"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("Edit LotteryWebReaderCode")])]),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" lotteryList"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("Request"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("LotteryListView"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Pre"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" List"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Lottery"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LotteryListView "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" LotteryListView"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_\n  request"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" Request"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Input"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("=>")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" input "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    LotteryReadQuery"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      row "),s("span",{attrs:{class:"token keyword"}},[t._v("=>")]),t._v("\n        Lottery"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n          lotteryName "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" row"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          amount "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" row"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("amount"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          participantList "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("  row"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("participantList"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          status "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("row"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("open"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{attrs:{class:"token string"}},[t._v('"OPEN"')]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('"CLOSED"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          winner "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" row"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("winner\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("clean the db")]),s("li",[t._v("$run")]),s("li",[t._v("Test through url in browser http://localhost:9000/api/lottery/lottery-list")])]),s("h2",{attrs:{id:"review-write-db"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#review-write-db","aria-hidden":"true"}},[t._v("#")]),t._v(" Review Write DB")]),s("ul",[s("li",[t._v("we dont really need amount and winner  in write db, they dont involve in any of the decision making in domain.")]),s("li",[t._v("edit "),s("code",[t._v("LotteryMongo.kmongo")]),t._v(" in eclipse")])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("collection Lottery {\n    property lotteryName:String\n    //property amount:Int\n    property participantList:String*\n    //property winner:String?\n    property open:Boolean\n}\n")])])]),s("ul",[s("li",[t._v("$compile, fix the error")]),s("li",[t._v("Test through curl\n"),s("ul",[s("li",[t._v('curl -H "Content-Type: application/json" -X POST -d \'{"lotteryName":"DLoto","amount":1000}\' http://localhost:9000/api/lottery/create-lottery')]),s("li",[t._v('curl -H "Content-Type: application/json" -X POST -d \'{"lotteryName":"DLoto","participantName":"John"}\' http://localhost:9000/api/lottery/  add-participant')]),s("li",[t._v('curl -H "Content-Type: application/json" -X POST -d \'{"lotteryName":"DLoto","participantName":"Jim"}\' http://localhost:9000/api/lottery/add-participant')]),s("li",[t._v('curl -H "Content-Type: application/json" -X POST -d \'{"lotteryName":"DLoto","participantName":"Joe"}\' http://localhost:9000/api/lottery/add-participant')]),s("li",[t._v('curl -H "Content-Type: application/json" -X POST -d \'{"lotteryName":"DLoto"}\' http://localhost:9000/api/lottery/run')])])])]),s("h2",{attrs:{id:"send-mail"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#send-mail","aria-hidden":"true"}},[t._v("#")]),t._v(" Send Mail")]),s("ul",[s("li",[s("p",[t._v("Sending email to winner needs us to capture email addresses for the participants")])]),s("li",[s("p",[t._v("Calls for an event update & change to read database to capture the email address")])]),s("li",[s("p",[t._v("Capturing email of a participant and sending  email to the winner")])]),s("li",[s("p",[t._v("Edit "),s("code",[t._v("LotteryReadMongo.kmongo")])])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("collection LotteryRead {\n     property lotteryName:String\n     property amount:Int\n     reference participantList:Participant*\n     property winner:String?\n     property open:Boolean\n}\n\ncollection Participant {\n     property name:String\n     property email:String\n}\n")])])]),s("ul",[s("li",[t._v("participant's email needs to be added to the event")]),s("li",[t._v("Edit "),s("code",[t._v("LotteryStream.kstream")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("event ParticipantAdded(lotteryName: String, participantName: String, email:String)\n")])])]),s("ul",[s("li",[t._v("Edit LotteryDomain.kdomain, replace addParticipant command with the following:")])]),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[t._v("command addParticipant "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    input"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lotteryName"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),s("span",{attrs:{class:"token builtin"}},[t._v("String")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" participantName"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),s("span",{attrs:{class:"token builtin"}},[t._v("String")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("participantEmail"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token builtin"}},[t._v("String")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    pre "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        condition lotteryMustExists "),s("span",{attrs:{class:"token string"}},[t._v('"Lottery must exist"')]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" lottery"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryNameExists"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        condition newParticpant "),s("span",{attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("lottery"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("participantExist"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" input"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("participantName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" failing "),s("span",{attrs:{class:"token string"}},[t._v('"participant ${input.participantName} is already add to this lottery"')]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    event"),s("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("raised"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("added"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v("ParticipantAdded"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("$compile, and fix the compiler errors")]),s("li",[t._v("Edit "),s("code",[t._v("LotteryProjectorCode")])])]),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("def")]),t._v(" project"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" ParticipantAdded"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" EventContext"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token builtin"}},[t._v("Unit")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LotteryReadQuery"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lotteryName"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" participantId "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" Id"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    ParticipantWriter"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("insert"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ParticipantRow"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_id "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" participantId"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("participantName"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" email "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("email"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("val")]),t._v(" u "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LotteryReadUpdate"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("participantList_oidList"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("addToSet"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("participantId"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    LotteryReadWriter"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updateOne"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("q"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" u"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n")])])]),s("ul",[s("li",[t._v("$compile, fix the error")]),s("li",[t._v("Test through curl\n"),s("ul",[s("li",[t._v("curl -X POST --header 'Content-Type: application/x-www-form-urlencoded' --header 'Accept: application/json' -d 'lotteryName=DLoto&amount=1000' 'http://localhost:9000/api/lottery/create-lottery'")]),s("li",[t._v("curl -X POST --header 'Content-Type: application/x-www-form-urlencoded' --header 'Accept: application/json' -d 'lotteryName=DLoto&participantName=John&participantEmail=john@gmail.com' 'http://localhost:9000/api/lottery/add-participant'")]),s("li",[t._v("curl -X POST --header 'Content-Type: application/x-www-form-urlencoded' --header 'Accept: application/json' -d 'lotteryName=DLoto&participantName=Jim&participantEmail=jim@gmail.com' 'http://localhost:9000/api/lottery/add-participant'")]),s("li",[t._v("curl -X POST --header 'Content-Type: application/x-www-form-urlencoded' --header 'Accept: application/json' -d 'lotteryName=DLoto&participantName=Joe&participantEmail=joe@gmail.com' 'http://localhost:9000/api/lottery/add-participant'")]),s("li",[t._v("curl -X POST --header 'Content-Type: application/x-www-form-urlencoded' --header 'Accept: application/json' -d 'lotteryName=DLoto' 'http://localhost:9000/api/lottery/run'")])])])])])}],!1,null,null,null);a.default=o.exports}}]);